# üîç Debug : Suppression de Produits - Permissions Firestore

## Probl√®me
Les produits ne peuvent pas √™tre supprim√©s dans le Menu Editor.

## Cause Probable
Les r√®gles de s√©curit√© Firestore bloquent les op√©rations `delete` sur la collection `products`.

## üîß Solution : V√©rifier et Corriger les R√®gles Firestore

### √âtape 1 : Acc√©der aux R√®gles Firestore
1. Allez sur [Firebase Console](https://console.firebase.google.com/)
2. S√©lectionnez votre projet
3. Dans le menu lat√©ral, cliquez sur **Firestore Database**
4. Cliquez sur l'onglet **R√®gles** (Rules)

### √âtape 2 : V√©rifier les R√®gles Actuelles
Recherchez les r√®gles pour la collection `products`. Vous devriez voir quelque chose comme :

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Products collection
    match /products/{productId} {
      allow read: if true; // Lecture publique
      allow write: if request.auth != null; // ‚ùå PROBL√àME ICI
    }
  }
}
```

### √âtape 3 : R√®gles Recommand√©es

Remplacez par ces r√®gles plus sp√©cifiques :

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Categories collection
    match /categories/{categoryId} {
      allow read: if true; // Public read for menu display
      allow create, update: if request.auth != null; // Authenticated admins only
      allow delete: if request.auth != null
        && !exists(/databases/$(database)/documents/products/{product})
        || get(/databases/$(database)/documents/products/{product}).data.categoryId != categoryId;
    }

    // Products collection
    match /products/{productId} {
      allow read: if true; // Public read for menu display
      allow create: if request.auth != null; // Authenticated users can create
      allow update: if request.auth != null; // Authenticated users can update
      allow delete: if request.auth != null; // ‚úÖ Authenticated users can delete
    }

    // Orders collection
    match /orders/{orderId} {
      allow read: if true; // Admins can read all orders
      allow create: if true; // Clients can create orders
      allow update: if request.auth != null; // Only admins can update
      allow delete: if request.auth != null; // Only admins can delete
    }

    // Customers collection
    match /customers/{customerId} {
      allow read, write: if request.auth != null; // Admin only
    }

    // Campaigns collection
    match /campaigns/{campaignId} {
      allow read: if true; // Public read for active campaigns
      allow write: if request.auth != null; // Admin only
    }

    // Coupons collection
    match /coupons/{couponId} {
      allow read: if true; // Public read to verify coupons
      allow create: if true; // Auto-generated by campaign API
      allow update: if true; // Mark as used
      allow delete: if request.auth != null; // Admin only
    }

    // Feedback collection
    match /feedback/{feedbackId} {
      allow read: if request.auth != null; // Admin only
      allow create: if true; // Clients can submit feedback
      allow update, delete: if request.auth != null; // Admin only
    }

    // Internal Reviews collection
    match /internal_reviews/{reviewId} {
      allow read: if request.auth != null; // Admin only
      allow create: if true; // Clients can submit reviews
      allow write: if request.auth != null; // Admin only
    }
  }
}
```

### √âtape 4 : Publier les R√®gles
1. Cliquez sur **Publier** (Publish) en haut √† droite
2. Confirmez la publication

### √âtape 5 : Tester
1. Retournez dans le Menu Editor
2. Essayez de supprimer un produit
3. Ouvrez la console du navigateur (F12) pour voir les erreurs √©ventuelles

## üß™ Test en D√©veloppement

Pour tester localement avec les r√®gles, ajoutez ceci dans votre console du navigateur :

```javascript
// Ouvrez la console (F12) sur la page Menu Editor
// Tentez de supprimer un produit et regardez les erreurs

// Si vous voyez :
// "FirebaseError: Missing or insufficient permissions"
// ‚Üí Les r√®gles Firestore bloquent la suppression

// Si vous voyez :
// "FirebaseError: Not found"
// ‚Üí Le produit n'existe pas (autre probl√®me)

// Si aucune erreur mais rien ne se passe :
// ‚Üí Probl√®me dans le code frontend
```

## ‚ö†Ô∏è S√©curit√©

Les r√®gles ci-dessus permettent :
- ‚úÖ Lecture publique des menus (n√©cessaire pour les clients)
- ‚úÖ √âcriture uniquement pour les utilisateurs authentifi√©s (admins)
- ‚úÖ Suppression uniquement pour les admins authentifi√©s

**Important** : Assurez-vous que seuls les admins ont acc√®s √† `/admin` via le syst√®me d'authentification.

## üîó Ressources
- [Documentation Firestore Security Rules](https://firebase.google.com/docs/firestore/security/get-started)
- [Tester les r√®gles Firestore](https://firebase.google.com/docs/firestore/security/test-rules-emulator)
